;; ---------------------------------------------------------------------------
;; Agent: Codex
;; Codex CLI binary, state, and config paths.
;; Source: 60-agents/codex.sb
;; ---------------------------------------------------------------------------

;; - npm/bun global installs place binaries under package-manager prefix/bin
;; - ~/.local/bin is the common user-level target and fallback
;; - local state/config
;; - package updates are package-manager driven via node toolchain paths

(allow file-read* file-write*
    (home-prefix "/.local/bin/codex")
    (home-subpath "/.codex")
    (home-subpath "/.cache/codex")
)

;; Keychain write access: Codex stores auth credentials via keyring crate (apple-native).
(allow file-write*
    (home-subpath "/Library/Keychains")
    (home-literal "/Library/Preferences/com.apple.security.plist")
)

(allow file-read*
    (home-literal "/Library/Preferences/com.openai.codex.plist")  ;; Codex user-level preferences plist.
    (literal "/Library/Preferences/com.openai.codex.plist")       ;; Codex system preferences plist (managed setups).
    (literal "/Library/Managed Preferences/com.openai.codex.plist") ;; Codex MDM-managed preferences payload.
    (subpath "/etc/codex")                                         ;; System-wide config and requirements layers.
)
