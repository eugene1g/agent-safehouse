;; ---------------------------------------------------------------------------
;; App: Claude Desktop
;; Claude for Desktop (Electron) app bundle, preferences, and data paths.
;; Source: 65-apps/claude-app.sb
;; $$require=55-integrations-optional/keychain.sb,55-integrations-optional/macos-gui.sb,55-integrations-optional/electron.sb$$
;; ---------------------------------------------------------------------------

;; Requires: 55-integrations-optional/macos-gui.sb   (window server, AppKit, input, accessibility)
;;           55-integrations-optional/electron.sb     (GPU, Metal, crashpad, WebView)

(allow file-read* file-write*
    (home-subpath "/Library/Application Support/Claude")
    (home-subpath "/Library/Logs/Claude")
    (home-subpath "/Library/HTTPStorages/com.anthropic.claudefordesktop")
    (home-subpath "/Library/Caches/Claude")
    (home-prefix "/Library/Caches/com.anthropic.claudefordesktop")
    (home-subpath "/Library/Saved Application State/com.anthropic.claudefordesktop.savedState")
)

(allow file-read*
    (subpath "/Applications/Claude.app")
    (home-literal "/Library/Preferences/com.anthropic.claudefordesktop.plist")
)

;; Claude Desktop persists app preferences via cfprefsd under its own domain.
(allow user-preference-read user-preference-write
    (preference-domain "com.anthropic.claudefordesktop")
)

;; Shared AppKit/Mach/fsctl allowances are provided by:
;;   55-integrations-optional/macos-gui.sb
;; This profile adds only app-specific MachPortRendezvousServer IPC grants.
(allow mach-lookup
    (global-name-regex #"^com\.anthropic\.claudefordesktop\.MachPortRendezvousServer\.")
)

(allow mach-register
    (global-name-regex #"^com\.anthropic\.claudefordesktop\.MachPortRendezvousServer\.")
)
